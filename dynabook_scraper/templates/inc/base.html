<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.colors.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <title>{% block title %}Toshiba/Dynabook Drivers and Manuals Archive{% endblock %}</title>

    <script src="https://cdn.jsdelivr.net/gh/orca-scan/appearance-changed-event@1.0.0/dist/appearance-changed-event.min.js"></script>

    <script>
        var _products = null;
        var _images = null;
        var _productsPromise = null;

        const archiveNameMap = {
            "archive.org": "the Internet Archive",
            "web.archive.org": "the Wayback Machine",
            "www.archive-it.org": "Archive-It",
            "content.us.dynabook.com": "Dynabook",
        };

        async function loadProducts() {
            if (_products !== null && _images !== null) {
                return;
            }

            if (_productsPromise != null) {
                return _productsPromise;
            }

            _productsPromise = (async () => {
                const indexUrl = '{{ base_url }}/all_products_flat.json';
                const response = await fetch(indexUrl);
                _products = await response.json();

                const imagesUrl = '{{ base_url }}/images.json';
                const imagesResponse = await fetch(imagesUrl);
                _images = await imagesResponse.json();
            })();

            await _productsPromise;
            _productsPromise = null;
        }

        function isEmpty(obj) {
            for (const prop in obj) {
                if (Object.hasOwn(obj, prop)) {
                    return false;
                }
            }

            return true;
        }

        function humanFileSize(size) {
            const i = size === 0 ? 0 : Math.floor(Math.log(size) / Math.log(1024));
            return +((size / Math.pow(1024, i)).toFixed(2)) + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i];
        }


        function renderContentListEntry(obj) {
            const entry = document.createElement('div');
            entry.classList.add('content-entry');

            const div = document.createElement('div');
            entry.appendChild(div);

            const title = document.createElement('p');
            title.classList.add('title');
            const link = document.createElement('a');
            link.href = "{{ base_url }}/content/?contentID=" + obj.contentID;
            // Use innerHTML since some titles contain HTML entities
            link.innerHTML = obj.title ?? obj.fileVersion;
            title.appendChild(link);
            div.appendChild(title);

            const pubDate = document.createElement('p');
            pubDate.classList.add('pub-date');
            pubDate.textContent = `Posted on: ${obj.orgPubDate ?? obj.startDate ?? obj.createDate}`;

            if (obj.fileVersion) {
                pubDate.textContent += ` | Version ${obj.fileVersion}`;
            }
            if (obj.fileSize) {
                pubDate.textContent += ` | ${humanFileSize(obj.fileSize)}`;
            }

            div.appendChild(pubDate);


            if (obj.status_code) {
                const dlDiv = document.createElement('div');
                const downloadBtn = document.createElement('a');
                dlDiv.appendChild(downloadBtn);
                dlDiv.setAttribute('data-placement', 'left');
                downloadBtn.classList.add('outline', 'download');
                downloadBtn.setAttribute('role', 'button');

                if (obj.status_code !== 200) {
                    entry.classList.add('unavailable');
                    downloadBtn.innerHTML = '<span class="material-icons">report_gmailerrorred</span> N/A';
                    downloadBtn.setAttribute('disabled', '');
                    downloadBtn.classList.add('secondary');

                    dlDiv.setAttribute('data-tooltip', `Got a ${obj.status_code} response at crawl time`);
                } else {
                    const contentFile = obj.contentFile;
                    const filename = contentFile.split('/').pop();
                    downloadBtn.innerHTML = `<span class="material-icons">file_download</span> Download`;
                    downloadBtn.href = `{{ base_url }}/assets/content/${obj.contentID}/${filename}`;

                    if (obj.mirror_hostname) {
                        dlDiv.setAttribute('data-tooltip', `From ${archiveNameMap[obj.mirror_hostname] ?? obj.mirror_hostname}`);
                    } else {
                        dlDiv.setAttribute('data-tooltip', `Original source`);
                    }
                }

                entry.appendChild(dlDiv);
            }

            return entry;
        }

        // Function provided for compatibility with the hardcoded content links in site
        function openSubDoc(contentID, _) {
            window.location.href = "{{ base_url }}/content/?contentID=" + contentID;
        }

        function printMe() {
            window.print();
        }
    </script>

    <style>
        ul.content-list {
            padding: 5px;
        }

        ul.content-list li {
            list-style-type: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
        }

        ul.content-list li p {
            margin: 0;
        }

        .aa-SubmitButton {
            display: none;
        }

        .content-entry, .product-header {
            display: flex;
            justify-content: space-between;
        }

        .product-image img {
            max-height: 200px;
        }

        .product-content {
            margin-top: 50px;
        }

        details details {
            margin-left: 1em;
        }

        .pre {
            font-family: monospace;
        }

        .download-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-line {
            padding: 10px 0;
        }

        .material-icons {
            position: relative;
            top: 5px;
        }

        a.download {
            min-width: 165px;
        }
    </style>

    {% block head %}{% endblock %}
</head>
<body>

<nav class="{% block nav_class %}container{% endblock %}">
    <ul>
        <li><strong><a href="{{ base_url }}/">Toshiba/Dynabook Drivers and Manuals Archive</a></strong></li>
    </ul>
    <ul>
        <li><a href="#">Source code</a></li>
        <li><a href="#" onclick="toggleTheme()"><span class="material-icons"
                                                      id="night-mode-toggle">light_mode</span></a></li>
    </ul>
</nav>

<main class="{% block main_class %}container{% endblock %}">
    {% block content %}{% endblock %}
</main>

<footer class="{% block footer_class %}container{% endblock %}">
    {% block footer %}
        <hr>

        <h4>Export Control and EULA</h4>
        <p>
            Use of any software made available for download from this system constitutes your acceptance of the Export
            Control Terms and the terms in the Dynabook end-user license agreement both of which you can <a
                href="../eula/">view</a> before downloading any such software.
        </p>
        <br>
        <hr>
        <p>
            This mirror website has been created and is hosted by <a href="https://depau.eu">Davide Depau</a>.
        </p>

        <p>
            The content on this site was originally
            hosted on the <a href="https://support.dynabook.com/drivers" target="_blank" rel="noopener"
                             referrerpolicy="no-referrer">Dynabook support website</a> and is provided free of charge
            for preservation purposes, with no affiliation with Dynabook and without any warranty, including but not
            limited to availability, accuracy of content and lack of malware or other harmful code.
        </p>

        <p>
            Some content has been obtained from <a href="https://timetravel.mementoweb.org/" target="_blank"
                                                   rel="noopener" referrerpolicy="no-referrer">web archives</a> and may
            not match the original content.
        </p>
    {% endblock %}
</footer>

<script>
    function refreshTheme() {
        const desiredTheme = getDesiredTheme();
        const html = document.querySelector('html');

        html.setAttribute('data-theme', desiredTheme);
        document.body.setAttribute('data-theme', desiredTheme);

        const otherTheme = desiredTheme === 'dark' ? 'light' : 'dark';
        document.getElementById('night-mode-toggle').textContent = `${otherTheme}_mode`;
    }

    function getDesiredTheme() {
        if (typeof window.localStorage !== "undefined") {
            const override = window.localStorage.getItem('override-theme');
            if (override) {
                return window.localStorage.getItem('forced-theme') ?? window.appearance;
            }
        }

        return window.appearance;
    }

    function toggleTheme() {
        setOverrideTheme(!getOverrideTheme());
    }

    function getOverrideTheme() {
        if (typeof window.localStorage !== "undefined") {
            return window.localStorage.getItem('override-theme') === 'true';
        }

        return false;
    }

    function setOverrideTheme(override) {
        if (typeof window.localStorage !== "undefined") {
            window.localStorage.setItem('override-theme', override);
            if (override) {
                let newAppearance = window.appearance === 'dark' ? 'light' : 'dark';
                window.localStorage.setItem('forced-theme', newAppearance);
            } else {
                window.localStorage.removeItem('forced-theme');
            }
        }
        refreshTheme();
    }

    refreshTheme();
    window.addEventListener('appearance-changed', function (e) {
        refreshTheme();
    });
</script>

</body>
</html>